# =========================
# General hooks for suspend / resume
# =========================
general {
    # Lock command (fallback if loginctl is unreliable)
    lock_cmd = pidof hyprlock || hyprlock

    # Aesthetic suspend flow:
    # 1. Turn displays off
    # 2. Lock session
    before_sleep_cmd = hyprctl dispatch dpms off && hyprlock

    # CRITICAL:
    # DPMS state survives suspend, so displays MUST be
    # explicitly powered back on after resume
    after_sleep_cmd = hyprctl dispatch dpms on

    # Ensure the lock is fully active before sleeping
    # Prevents race conditions and unlocked resumes
    inhibit_sleep = 3
}

# =========================
# Lid switch handling
# =========================

# Lid closed → suspend system
listener {
    event = sw-down
    on-status-changed = systemctl suspend
}

# Lid opened → force displays back on
listener {
    event = sw-up
    on-status-changed = hyprctl dispatch dpms on
}

# =========================
# Idle timeouts
# =========================

# Lock after inactivity
listener {
    timeout = 420        # 7 minutes

    # Lock while screen is still on for usability
    on-timeout = pidof hyprlock || hyprlock
}

# Turn displays off after inactivity (DPMS)
listener {
    timeout = 420        # 7 minutes

    # Only power off displays if already locked
    # Prevents accidental black screen during use
    on-timeout = pidof hyprlock && hyprctl dispatch dpms off
}

# Suspend after inactivity
listener {
    timeout = 600        # 10 minutes

    # DPMS off + lock are guaranteed by before_sleep_cmd
    on-timeout = systemctl suspend
}

